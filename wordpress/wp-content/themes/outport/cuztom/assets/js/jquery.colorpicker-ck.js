/*
 * jQuery miniColors: A small color selector
 *
 * Copyright 2011 Cory LaViska for A Beautiful Site, LLC. (http://abeautifulsite.net/)
 *
 * Dual licensed under the MIT or GPL Version 2 licenses
 *
*/jQuery&&function(e){e.extend(e.fn,{miniColors:function(t,n){var r=function(t,n,r){var i=y(t.val());i||(i="ffffff");var s=x(i),f=e('<a class="miniColors-trigger" style="background-color: #'+i+'" href="#"></a>');f.insertAfter(t);t.addClass("miniColors").data("original-maxlength",t.attr("maxlength")||null).data("original-autocomplete",t.attr("autocomplete")||null).data("letterCase","uppercase").data("trigger",f).data("hsb",s).data("change",n.change?n.change:null).data("close",n.close?n.close:null).data("open",n.open?n.open:null).attr("maxlength",7).attr("autocomplete","off").val("#"+d(i,n.letterCase));n.readonly&&t.prop("readonly",!0);n.disabled&&o(t);f.bind("click.miniColors",function(e){e.preventDefault();t.val()===""&&t.val("#");u(t)});t.bind("focus.miniColors",function(e){t.val()===""&&t.val("#");u(t)});t.bind("blur.miniColors",function(e){var n=y(T(t.data("hsb")));t.val(n?"#"+d(n,t.data("letterCase")):"")});t.bind("keydown.miniColors",function(e){e.keyCode===9&&a(t)});t.bind("keyup.miniColors",function(e){p(t)});t.bind("paste.miniColors",function(e){setTimeout(function(){p(t)},5)})},i=function(t){a();t=e(t);t.data("trigger").remove();t.attr("autocomplete",t.data("original-autocomplete")).attr("maxlength",t.data("original-maxlength")).removeData().removeClass("miniColors").unbind(".miniColors");e(document).unbind(".miniColors")},s=function(e){e.prop("disabled",!1).data("trigger").css("opacity",1)},o=function(e){a(e);e.prop("disabled",!0).data("trigger").css("opacity",.5)},u=function(t){if(t.prop("disabled"))return!1;a();var n=e('<div class="miniColors-selector"></div>');n.append('<div class="miniColors-colors" style="background-color: #FFF;"><div class="miniColors-colorPicker"><div class="miniColors-colorPicker-inner"></div></div>').append('<div class="miniColors-hues"><div class="miniColors-huePicker"></div></div>').css({top:t.is(":visible")?t.offset().top+t.outerHeight():t.data("trigger").offset().top+t.data("trigger").outerHeight(),left:t.is(":visible")?t.offset().left:t.data("trigger").offset().left,display:"none"}).addClass(t.attr("class"));var r=t.data("hsb");n.find(".miniColors-colors").css("backgroundColor","#"+T({h:r.h,s:100,b:100}));var i=t.data("colorPosition");i||(i=v(r));n.find(".miniColors-colorPicker").css("top",i.y+"px").css("left",i.x+"px");var s=t.data("huePosition");s||(s=m(r));n.find(".miniColors-huePicker").css("top",s.y+"px");t.data("selector",n).data("huePicker",n.find(".miniColors-huePicker")).data("colorPicker",n.find(".miniColors-colorPicker")).data("mousebutton",0);e("BODY").append(n);n.fadeIn(100);n.bind("selectstart",function(){return!1});e(document).bind("mousedown.miniColors touchstart.miniColors",function(n){t.data("mousebutton",1);var r=e(n.target).parents().andSelf();if(r.hasClass("miniColors-colors")){n.preventDefault();t.data("moving","colors");f(t,n)}if(r.hasClass("miniColors-hues")){n.preventDefault();t.data("moving","hues");l(t,n)}if(r.hasClass("miniColors-selector")){n.preventDefault();return}if(r.hasClass("miniColors"))return;a(t)});e(document).bind("mouseup.miniColors touchend.miniColors",function(e){e.preventDefault();t.data("mousebutton",0).removeData("moving")}).bind("mousemove.miniColors touchmove.miniColors",function(e){e.preventDefault();if(t.data("mousebutton")===1){t.data("moving")==="colors"&&f(t,e);t.data("moving")==="hues"&&l(t,e)}});t.data("open")&&t.data("open").call(t.get(0),"#"+T(r),b(r))},a=function(t){t||(t=".miniColors");e(t).each(function(){var n=e(this).data("selector");e(this).removeData("selector");e(n).fadeOut(100,function(){if(t.data("close")){var n=t.data("hsb"),r=T(n);t.data("close").call(t.get(0),"#"+r,b(n))}e(this).remove()})});e(document).unbind(".miniColors")},f=function(e,t){var n=e.data("colorPicker");n.hide();var r={x:t.pageX,y:t.pageY};if(t.originalEvent.changedTouches){r.x=t.originalEvent.changedTouches[0].pageX;r.y=t.originalEvent.changedTouches[0].pageY}r.x=r.x-e.data("selector").find(".miniColors-colors").offset().left-5;r.y=r.y-e.data("selector").find(".miniColors-colors").offset().top-5;r.x<=-5&&(r.x=-5);r.x>=144&&(r.x=144);r.y<=-5&&(r.y=-5);r.y>=144&&(r.y=144);e.data("colorPosition",r);n.css("left",r.x).css("top",r.y).show();var i=Math.round((r.x+5)*.67);i<0&&(i=0);i>100&&(i=100);var s=100-Math.round((r.y+5)*.67);s<0&&(s=0);s>100&&(s=100);var o=e.data("hsb");o.s=i;o.b=s;c(e,o,!0)},l=function(e,t){var n=e.data("huePicker");n.hide();var r={y:t.pageY};t.originalEvent.changedTouches&&(r.y=t.originalEvent.changedTouches[0].pageY);r.y=r.y-e.data("selector").find(".miniColors-colors").offset().top-1;r.y<=-1&&(r.y=-1);r.y>=149&&(r.y=149);e.data("huePosition",r);n.css("top",r.y).show();var i=Math.round((150-r.y-1)*2.4);i<0&&(i=0);i>360&&(i=360);var s=e.data("hsb");s.h=i;c(e,s,!0)},c=function(e,t,n){e.data("hsb",t);var r=T(t);n&&e.val("#"+d(r,e.data("letterCase")));e.data("trigger").css("backgroundColor","#"+r);e.data("selector")&&e.data("selector").find(".miniColors-colors").css("backgroundColor","#"+T({h:t.h,s:100,b:100}));if(e.data("change")){if(r===e.data("lastChange"))return;e.data("change").call(e.get(0),"#"+r,b(t));e.data("lastChange",r)}},p=function(t){t.val("#"+g(t.val()));var n=y(t.val());if(!n)return!1;var r=x(n),i=t.data("hsb");if(r.h===i.h&&r.s===i.s&&r.b===i.b)return!0;var s=v(r),o=e(t.data("colorPicker"));o.css("top",s.y+"px").css("left",s.x+"px");t.data("colorPosition",s);var u=m(r),a=e(t.data("huePicker"));a.css("top",u.y+"px");t.data("huePosition",u);c(t,r);return!0},d=function(e,t){return t==="lowercase"?e.toLowerCase():t==="uppercase"?e.toUpperCase():e},v=function(e){var t=Math.ceil(e.s/.67);t<0&&(t=0);t>150&&(t=150);var n=150-Math.ceil(e.b/.67);n<0&&(n=0);n>150&&(n=150);return{x:t-5,y:n-5}},m=function(e){var t=150-e.h/2.4;t<0&&(h=0);t>150&&(h=150);return{y:t-1}},g=function(e){return e.replace(/[^A-F0-9]/ig,"")},y=function(e){e=g(e);if(!e)return null;e.length===3&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);return e.length===6?e:null},b=function(e){var t={},n=Math.round(e.h),r=Math.round(e.s*255/100),i=Math.round(e.b*255/100);if(r===0)t.r=t.g=t.b=i;else{var s=i,o=(255-r)*i/255,u=(s-o)*(n%60)/60;n===360&&(n=0);if(n<60){t.r=s;t.b=o;t.g=o+u}else if(n<120){t.g=s;t.b=o;t.r=s-u}else if(n<180){t.g=s;t.r=o;t.b=o+u}else if(n<240){t.b=s;t.r=o;t.g=s-u}else if(n<300){t.b=s;t.g=o;t.r=o+u}else if(n<360){t.r=s;t.g=o;t.b=s-u}else{t.r=0;t.g=0;t.b=0}}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},w=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];e.each(n,function(e,t){t.length===1&&(n[e]="0"+t)});return n.join("")},E=function(e){e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(e&65280)>>8,b:e&255}},S=function(e){var t={h:0,s:0,b:0},n=Math.min(e.r,e.g,e.b),r=Math.max(e.r,e.g,e.b),i=r-n;t.b=r;t.s=r!==0?255*i/r:0;t.s!==0?e.r===r?t.h=(e.g-e.b)/i:e.g===r?t.h=2+(e.b-e.r)/i:t.h=4+(e.r-e.g)/i:t.h=-1;t.h*=60;t.h<0&&(t.h+=360);t.s*=100/255;t.b*=100/255;return t},x=function(e){var t=S(E(e));t.s===0&&(t.h=360);return t},T=function(e){return w(b(e))};switch(t){case"readonly":e(this).each(function(){if(!e(this).hasClass("miniColors"))return;e(this).prop("readonly",n)});return e(this);case"disabled":e(this).each(function(){if(!e(this).hasClass("miniColors"))return;n?o(e(this)):s(e(this))});return e(this);case"value":if(n===undefined){if(!e(this).hasClass("miniColors"))return;var N=e(this),C=y(N.val());return C?"#"+d(C,N.data("letterCase")):null}e(this).each(function(){if(!e(this).hasClass("miniColors"))return;e(this).val(n);p(e(this))});return e(this);case"destroy":e(this).each(function(){if(!e(this).hasClass("miniColors"))return;i(e(this))});return e(this);default:t||(t={});e(this).each(function(){if(e(this)[0].tagName.toLowerCase()!=="input")return;if(e(this).data("trigger"))return;r(e(this),t,n)});return e(this)}}})}(jQuery);